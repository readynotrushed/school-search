<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dubai School Search</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
            background: #FFFFFF;
            color: #1F1F1F;
            line-height: 1.5;
            font-size: 14px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 24px;
        }

        .header {
            margin-bottom: 32px;
        }

        h1 {
            font-size: 40px;
            font-weight: 700;
            color: #000000;
            margin-bottom: 4px;
            letter-spacing: -0.03em;
        }

        .tagline {
            font-size: 24px;
            font-weight: 600;
            color: #000000;
            margin-bottom: 12px;
            font-style: regular;
        }

        .subtitle {
            font-size: 16px;
            color: #525252;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .next-update {
            margin-top: 16px;
            padding: 16px;
            background: #F5F5F5;
            border-radius: 8px;
            border-left: 3px solid #2383E2;
        }

        .next-update strong {
            color: #000000;
            font-size: 15px;
        }

        .next-update ul {
            margin: 8px 0 12px 20px;
            color: #1F1F1F;
        }

        .next-update li {
            margin: 4px 0;
        }

        .next-update p {
            margin: 0;
            color: #525252;
            font-size: 14px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .info-section-large {
            background: #F5F5F5;
            border-radius: 8px;
            padding: 24px;
        }

        .info-section-sidebar {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .tip-section {
            background: #F5F5F5;
            border-radius: 8px;
            padding: 20px;
        }

        .section-title-large {
            font-size: 40px;
            font-weight: 700;
            color: #000000;
            margin-bottom: 12px;
            letter-spacing: -0.03em;
        }

        .section-title-small {
            font-size: 20px;
            font-weight: 600;
            color: #000000;
            margin-bottom: 8px;
        }

        .info-section-large p,
        .tip-section p {
            font-size: 14px;
            color: #1F1F1F;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .info-section-large p:last-child,
        .tip-section p:last-child {
            margin-bottom: 0;
        }

        .disclaimer {
            font-style: italic;
            color: #525252;
            font-weight: 400 !important;
        }

        .coming-soon-badge {
            display: inline-block;
            background: #FFE5B4;
            color: #8B4513;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 6px;
            transition: background 0.15s;
        }

        .coming-soon-badge:hover {
            background: #FFD89B;
        }

        .info-badge {
            display: inline-block;
            background: #E8F5E9;
            color: #2E7D32;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 4px;
        }

        .stats {
            background: #F5F5F5;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            flex: 1;
        }

        .stats-value {
            font-size: 48px;
            font-weight: 700;
            color: #000000;
        }

        .stats-label {
            font-size: 14px;
            color: #525252;
            margin-top: 4px;
        }

        .contribution-stats {
            background: #F5F5F5;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            border-left: 3px solid #2383E2;
        }

        .contribution-progress {
            margin-bottom: 12px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #E8E8E8;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2383E2 0%, #1a6ec0 100%);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 14px;
            color: #1F1F1F;
            font-weight: 500;
        }

        .contribution-cta {
            font-size: 13px;
            color: #525252;
        }

        .sort-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #D1D1D1;
        }

        .sort-bar label {
            font-size: 13px;
            font-weight: 600;
            color: #000000;
        }

        .sort-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .sort-btn {
            padding: 6px 12px;
            border: 1px solid #D1D1D1;
            background: white;
            color: #1F1F1F;
            border-radius: 3px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            font-family: inherit;
        }

        .sort-btn:hover {
            background: #F5F5F5;
        }

        .sort-btn.active {
            background: #2383E2;
            color: white;
            border-color: #2383E2;
        }

        .update-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 4px;
        }

        .update-badge.updated {
            background: #E8F5E9;
            color: #2E7D32;
        }

        .update-badge.not-updated {
            background: #FFF3E0;
            color: #E65100;
        }

        .filters {
            background: #F5F5F5;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-group label {
            font-size: 12px;
            font-weight: 600;
            color: #000000;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: 1px solid #D1D1D1;
            border-radius: 3px;
            font-size: 14px;
            font-family: inherit;
            background: white;
            color: #1F1F1F;
        }

        .filter-group select:disabled,
        .filter-group input:disabled {
            background: #F5F5F5;
            color: #999999;
            cursor: not-allowed;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #2383E2;
        }

        .filter-note {
            font-size: 11px;
            color: #666666;
            margin-top: 4px;
            font-style: italic;
        }

        .school-card {
            background: white;
            border: 1px solid #D1D1D1;
            border-radius: 3px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.15s;
        }

        .school-card:hover {
            border-color: #999999;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .school-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
            gap: 16px;
        }

        .school-name {
            font-size: 18px;
            font-weight: 600;
            color: #000000;
            margin-bottom: 4px;
        }

        .school-location {
            color: #2383E2;
            font-size: 14px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .school-location:hover {
            text-decoration: underline;
        }

        .age-badge {
            background: #E8E8E8;
            padding: 6px 12px;
            border-radius: 3px;
            font-weight: 500;
            font-size: 13px;
            white-space: nowrap;
            color: #1F1F1F;
        }

        .school-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-label {
            font-size: 11px;
            color: #666666;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-value {
            font-size: 14px;
            color: #1F1F1F;
        }

        .detail-value.empty {
            color: #2383E2;
            font-style: normal;
            cursor: pointer;
            transition: color 0.15s;
            font-weight: 500;
        }

        .detail-value.empty:hover {
            color: #1a6ec0;
            text-decoration: underline;
        }

        .school-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            padding-top: 16px;
            border-top: 1px solid #D1D1D1;
        }

        .btn {
            padding: 6px 12px;
            border-radius: 3px;
            font-weight: 500;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border: none;
            font-family: inherit;
        }

        .btn-primary {
            background: #2383E2;
            color: white;
        }

        .btn-primary:hover {
            background: #1a6ec0;
        }

        .btn-outline {
            background: white;
            border: 1px solid #D1D1D1;
            color: #1F1F1F;
        }

        .btn-outline:hover {
            background: #F5F5F5;
        }

        .no-results {
            text-align: center;
            padding: 48px 24px;
            color: #666666;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 3px;
            padding: 32px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        .modal-header {
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #000000;
            margin-bottom: 8px;
        }

        .modal-subtitle {
            font-size: 14px;
            color: #525252;
            line-height: 1.5;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 13px;
            color: #000000;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #D1D1D1;
            border-radius: 3px;
            font-size: 14px;
            font-family: inherit;
            background: white;
            color: #1F1F1F;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2383E2;
        }

        .form-note {
            font-size: 12px;
            color: #666666;
            margin-top: 4px;
        }

        .close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666666;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
        }

        .close-btn:hover {
            background: #F5F5F5;
            color: #1F1F1F;
        }

        @media (max-width: 768px) {
            .container {
                padding: 24px 16px;
            }

            h1 {
                font-size: 32px;
            }

            .section-title-large {
                font-size: 32px;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .school-details {
                grid-template-columns: 1fr;
            }

            .school-header {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>2022 / 2023 school finder</h1>
            <p class="tagline">A free crowdsource project to simplify finding school placements in Dubai</p>
            <p class="subtitle">Search schools and early childhood centres. Share your knowledge</p>
            <div class="next-update">
                <strong>What you can do now:</strong>
                <ul>
                    <li>Filter by the growing database of <strong>FS1 / Pre-KG</strong> and <strong>FS2 / KG1 availability</strong></li>
                    <li>Search by curriculum (150 schools already categorised)</li>
                    <li>Filter by location across Dubai areas</li>
                </ul>
                <p><strong>NEW CUT-OFF AGE: </strong>children born in 2023 ‚Üí FS1 / Pre-KG ||| children born in 2022  ‚Üí FS2 / KG1</p>
                <p>Help complete the database by pressing <strong>CONTRIBUTE INFO</strong> on schools you know</p>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-section-large">
                <h2 class="section-title-large">Made for parents, by parents</h2>
                <p>Information is provided by families and educators with the goal of supporting each other by sharing knowledge.</p>
                <p>Help complete the database by pressing the <strong>CONTRIBUTE INFO</strong> button on each listing.</p>
                <p>People are welcome to contribute with their knowledge for the benefit of everyone.</p>
                <p class="disclaimer">Aways double check the info at the source.</p>
            </div>
            
            <div class="info-section-sidebar">
                <div class="tip-section">
                    <h3 class="section-title-small">How to search</h3>
                    <p>The database is a work in progress, so filtering work by addition, not exclusion.</p>
                    <p>Example: filtering by FS1 availability will show schools categorised with FS1 as "available" and "unknown."</p>
                </div>
                
                <div class="stats">
                    <div class="stats-value" id="totalSchools">410</div>
                    <div class="stats-label">Schools & ECCs in the database</div>
                </div>
            </div>
        </div>

        <div class="contribution-stats">
            <div class="contribution-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-text">
                    <span id="updatedCount">0</span> of 410 schools have contributor data
                </div>
            </div>
            <div class="contribution-cta">
                Help complete the database - press <strong>CONTRIBUTE INFO</strong> on schools you know
            </div>
        </div>

        <div class="filters">
            <div class="sort-bar">
                <label>Sort by:</label>
                <div class="sort-buttons">
                    <button class="sort-btn active" data-sort="default">Default</button>
                    <button class="sort-btn" data-sort="latest">Latest Updates</button>
                </div>
            </div>

            <div class="filters-grid">
                <div class="filter-group">
                    <label for="locationFilter">Location</label>
                    <select id="locationFilter">
                        <option value="">All Locations</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="curriculumFilter">Curriculum</label>
                    <select id="curriculumFilter">
                        <option value="">All Curricula</option>
                        <option value="British / EYFS">British / EYFS (85)</option>
                        <option value="American">American (37)</option>
                        <option value="IB / PYP">IB / PYP (16)</option>
                        <option value="UK / IB">UK / IB (9)</option>
                        <option value="UK / American">UK / American (2)</option>
                        <option value="American / IB">American / IB (1)</option>
                    </select>
                    <p class="filter-note">Uncategorised schools will always appear</p>
                </div>

                <div class="filter-group">
                    <label for="fs1Filter">FS1 / Pre-KG Availability <span class="info-badge" onclick="showAvailInfo()">‚ÑπÔ∏è</span></label>
                    <select id="fs1Filter">
                        <option value="">All (including unknown)</option>
                        <option value="Yes">Accepting Enrollment</option>
                        <option value="Waitlist">Waitlist Available</option>
                        <option value="No">Full / Not Available</option>
                    </select>
                    <p class="filter-note">For students born in 2023</p>
                </div>

                <div class="filter-group">
                    <label for="fs2Filter">FS2 / KG1 Availability <span class="info-badge" onclick="showAvailInfo()">‚ÑπÔ∏è</span></label>
                    <select id="fs2Filter">
                        <option value="">All (including unknown)</option>
                        <option value="Yes">Accepting Enrollment</option>
                        <option value="Waitlist">Waitlist Available</option>
                        <option value="No">Full / Not Available</option>
                    </select>
                    <p class="filter-note">For students born in 2022</p>
                </div>

                <div class="filter-group">
                    <label for="searchBox">Search by Name</label>
                    <input type="text" id="searchBox" placeholder="Type school name...">
                </div>
            </div>
        </div>

        <div id="schoolList"></div>
    </div>

    <div class="modal" id="submitModal">
        <div class="modal-content" style="position: relative;">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title">Contribute School Information</h2>
                <p class="modal-subtitle">Help build a comprehensive database for all families. Share what you know about this school.</p>
            </div>
            <form id="submitForm">
                <input type="hidden" id="schoolName" name="schoolName">
                
                <div class="form-group">
                    <label>School Name</label>
                    <input type="text" id="schoolNameDisplay" readonly style="background: #F7F6F3;">
                </div>

                <div class="form-group">
                    <label for="curriculum">Curriculum</label>
                    <select id="curriculum" name="curriculum">
                        <option value="">Select curriculum...</option>
                        <option value="British / EYFS">British / EYFS</option>
                        <option value="Montessori">Montessori</option>
                        <option value="IB / PYP">IB / PYP</option>
                        <option value="American">American</option>
                        <option value="Indian">Indian</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="fs1Available">FS1 / Pre-KG Availability</label>
                    <select id="fs1Available" name="fs1Available">
                        <option value="">Select...</option>
                        <option value="Yes">Accepting Enrollment</option>
                        <option value="Waitlist">Waitlist Available</option>
                        <option value="No">Full / Not Available</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="fs2Available">FS2 / KG1 Availability</label>
                    <select id="fs2Available" name="fs2Available">
                        <option value="">Select...</option>
                        <option value="Yes">Accepting Enrollment</option>
                        <option value="Waitlist">Waitlist Available</option>
                        <option value="No">Full / Not Available</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="notes">Additional Information</label>
                    <textarea id="notes" name="notes" placeholder="Waitlist length, recent changes, enrollment criteria, contact person, etc."></textarea>
                </div>

                <div class="form-group">
                    <label for="parentName">Your Name (Optional)</label>
                    <input type="text" id="parentName" name="parentName" placeholder="Your name">
                    <p class="form-note">Optional - helps verify information</p>
                </div>

                <div class="form-group">
                    <label for="parentContact">Your Contact (Optional)</label>
                    <input type="text" id="parentContact" name="parentContact" placeholder="Email or phone">
                    <p class="form-note">Optional - in case clarification is needed</p>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">Send Information</button>
            </form>
        </div>
    </div>

    <script>
        // EMBEDDED DATA - Will be inserted here
    </script>

    <script>
        let allSchools = [];
        let filteredSchools = [];
        let currentSort = 'default';

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
        }

        function hasContributorData(school) {
            return school.curriculum || school.fs1_available || school.fs2_available || school.waitlist_status || school.notes;
        }

        function updateStatistics() {
            const updatedSchools = allSchools.filter(hasContributorData);
            const updatedCount = updatedSchools.length;
            const percentage = Math.round((updatedCount / allSchools.length) * 100);
            
            document.getElementById('updatedCount').textContent = updatedCount;
            document.getElementById('progressFill').style.width = percentage + '%';
        }
function sortSchools() {
    const curriculumFilter = document.getElementById('curriculumFilter').value;
    const fs1Filter = document.getElementById('fs1Filter').value;
    const fs2Filter = document.getElementById('fs2Filter').value;
    
    if (currentSort === 'latest') {
        filteredSchools.sort((a, b) => {
            // Schools with updates first
            const aHasData = hasContributorData(a);
            const bHasData = hasContributorData(b);
            
            if (aHasData && !bHasData) return -1;
            if (!aHasData && bHasData) return 1;
            
            // Then by last_updated date (most recent first)
            if (a.last_updated && b.last_updated) {
                return new Date(b.last_updated) - new Date(a.last_updated);
            }
            if (a.last_updated) return -1;
            if (b.last_updated) return 1;
            
            return 0;
        });
    } else {
        // Default sort - but prioritize matching filters
        filteredSchools.sort((a, b) => {
            // If curriculum filter is active, prioritize exact matches
            if (curriculumFilter) {
                const aMatches = a.curriculum === curriculumFilter;
                const bMatches = b.curriculum === curriculumFilter;
                if (aMatches && !bMatches) return -1;
                if (!aMatches && bMatches) return 1;
            }
            
            // If FS1 filter is active, prioritize exact matches
            if (fs1Filter) {
                const aMatches = a.fs1_available === fs1Filter;
                const bMatches = b.fs1_available === fs1Filter;
                if (aMatches && !bMatches) return -1;
                if (!aMatches && bMatches) return 1;
            }
            
            // If FS2 filter is active, prioritize exact matches
            if (fs2Filter) {
                const aMatches = a.fs2_available === fs2Filter;
                const bMatches = b.fs2_available === fs2Filter;
                if (aMatches && !bMatches) return -1;
                if (!aMatches && bMatches) return 1;
            }
            
            return 0; // Keep original order for rest
        });
    }
}

        async function loadSchools() {
            try {
                const response = await fetch('schools_data.json');
                allSchools = await response.json();
                filteredSchools = [...allSchools];
                
                const locations = [...new Set(allSchools.map(s => s.location).filter(l => l))].sort();
                const locationFilter = document.getElementById('locationFilter');
                locations.forEach(loc => {
                    const option = document.createElement('option');
                    option.value = loc;
                    option.textContent = loc;
                    locationFilter.appendChild(option);
                });

                updateStatistics();
                renderSchools();
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('schoolList').innerHTML = '<p class="no-results">Error loading school data</p>';
            }
        }

        // Sort button handlers
        document.querySelectorAll('.sort-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentSort = btn.dataset.sort;
                applyFilters();
            });
        });

        document.getElementById('locationFilter').addEventListener('change', applyFilters);
        document.getElementById('curriculumFilter').addEventListener('change', applyFilters);
        document.getElementById('fs1Filter').addEventListener('change', applyFilters);
        document.getElementById('fs2Filter').addEventListener('change', applyFilters);
        document.getElementById('searchBox').addEventListener('input', applyFilters);

        function applyFilters() {
            const locationFilter = document.getElementById('locationFilter').value;
            const curriculumFilter = document.getElementById('curriculumFilter').value;
            const fs1Filter = document.getElementById('fs1Filter').value;
            const fs2Filter = document.getElementById('fs2Filter').value;
            const searchText = document.getElementById('searchBox').value.toLowerCase();

            filteredSchools = allSchools.filter(school => {
                // Location filter
                if (locationFilter && school.location !== locationFilter) return false;
                
                // Curriculum filter - show selected OR schools with no curriculum data
                if (curriculumFilter) {
                    if (school.curriculum && school.curriculum !== curriculumFilter) return false;
                    // If school has no curriculum, still show it
                }
                
                // FS1 availability filter - only filter if value is set AND school has data
                if (fs1Filter && school.fs1_available) {
                    if (school.fs1_available !== fs1Filter) return false;
                }
                
                // FS2 availability filter - only filter if value is set AND school has data
                if (fs2Filter && school.fs2_available) {
                    if (school.fs2_available !== fs2Filter) return false;
                }
                
                // Search filter
                if (searchText && !school.name.toLowerCase().includes(searchText)) return false;
                
                return true;
            });

            sortSchools();
            renderSchools();
        }

        function renderSchools() {
            const container = document.getElementById('schoolList');
            document.getElementById('totalSchools').textContent = filteredSchools.length;

            if (filteredSchools.length === 0) {
                container.innerHTML = '<div class="no-results"><p>No schools found. Try different filters.</p></div>';
                return;
            }

            container.innerHTML = filteredSchools.map(school => {
                const mapsUrl = school.lat && school.lng 
                    ? `https://www.google.com/maps/search/?api=1&query=${school.lat},${school.lng}`
                    : null;

                return `
                <div class="school-card">
                    <div class="school-header">
                        <div style="flex: 1;">
                            <h3 class="school-name">${school.name}</h3>
                            ${mapsUrl ? `<a href="${mapsUrl}" target="_blank" class="school-location">üìç ${school.location || 'Location not specified'}</a>` : `<p class="school-location" style="color: #9B9A97;">üìç ${school.location || 'Location not specified'}</p>`}
                            ${school.last_updated ? `<span class="update-badge updated">Last updated: ${formatDate(school.last_updated)}</span>` : `<span class="update-badge not-updated">NO INFO RECEIVED</span>`}
                        </div>
                        <div class="age-badge">${school.grade_range || `Ages ${school.age_from}-${school.age_to}`}</div>
                    </div>

                    <div class="school-details">
                        <div class="detail-item">
                            <span class="detail-label">Curriculum</span>
                            <span class="detail-value ${!school.curriculum ? 'empty' : ''}" onclick="${!school.curriculum ? `openSubmitModal('${school.name.replace(/'/g, "\\'")}')` : ''}">${school.curriculum || 'Add info ‚Üí'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">FS1 / Pre-KG Availability</span>
                            <span class="detail-value ${!school.fs1_available ? 'empty' : ''}" onclick="${!school.fs1_available ? `openSubmitModal('${school.name.replace(/'/g, "\\'")}')` : ''}">${school.fs1_available || 'Add info ‚Üí'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">FS2 / KG1 Availability</span>
                            <span class="detail-value ${!school.fs2_available ? 'empty' : ''}" onclick="${!school.fs2_available ? `openSubmitModal('${school.name.replace(/'/g, "\\'")}')` : ''}">${school.fs2_available || 'Add info ‚Üí'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Waitlist Status</span>
                            <span class="detail-value ${!school.waitlist_status ? 'empty' : ''}" onclick="${!school.waitlist_status ? `openSubmitModal('${school.name.replace(/'/g, "\\'")}')` : ''}">${school.waitlist_status || 'Add info ‚Üí'}</span>
                        </div>
                    </div>

                    ${school.notes ? `<div style="margin-top: 12px; padding: 12px; background: #F7F6F3; border-radius: 3px; font-size: 13px; color: #787674;"><strong style="color: #37352F;">Notes:</strong> ${school.notes}</div>` : ''}

                    <div class="school-actions">
                        ${school.website ? `<a href="${school.website}" target="_blank" class="btn btn-outline">Website</a>` : ''}
                        ${school.email ? `<a href="mailto:${school.email}" class="btn btn-outline">Email</a>` : ''}
                        ${school.phone ? `<a href="tel:${school.phone}" class="btn btn-outline">Call</a>` : ''}
                        <button class="btn btn-primary" onclick="openSubmitModal('${school.name.replace(/'/g, "\\'")}')">Contribute Info</button>
                    </div>
                </div>
            `}).join('');
        }

        function openSubmitModal(schoolName) {
            document.getElementById('schoolName').value = schoolName;
            document.getElementById('schoolNameDisplay').value = schoolName;
            document.getElementById('submitModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('submitModal').classList.remove('active');
            document.getElementById('submitForm').reset();
        }

        document.getElementById('submitForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            const emailBody = `
School Information Contribution

School: ${data.schoolName}
Curriculum: ${data.curriculum || 'Not provided'}
FS1 Availability: ${data.fs1Available || 'Not provided'}
FS2 Availability: ${data.fs2Available || 'Not provided'}

Additional Information:
${data.notes || 'None'}

Submitted by: ${data.parentName || 'Anonymous'}
Contact: ${data.parentContact || 'Not provided'}
Date: ${new Date().toLocaleDateString()}
            `.trim();

            const mailtoLink = `mailto:readynotrushed@pm.me?subject=${encodeURIComponent('ECC Info: ' + data.schoolName)}&body=${encodeURIComponent(emailBody)}`;
            window.location.href = mailtoLink;
            
            setTimeout(() => {
                closeModal();
                alert('Your email client should open. Please send the email to submit your contribution.');
            }, 500);
        });

        document.getElementById('submitModal').addEventListener('click', (e) => {
            if (e.target.id === 'submitModal') closeModal();
        });

        function showComingSoon() {
            alert('Help build this feature!\n\nPress the CONTRIBUTE INFO button on any school listing to share curriculum and availability information.\n\nOnce enough data is collected, these filters will become active.');
        }

        function showAvailInfo() {
            alert('Understanding availability filters:\n\n‚Ä¢ FS1 / Pre-KG is for children born in 2023\n‚Ä¢ FS2 / KG1 is for children born in 2022\n\nIMPORTANT: Many schools don\'t have availability data yet. Always contact schools directly to confirm current availability, even if not listed here.\n\nHelp build the database by pressing CONTRIBUTE INFO on schools you know!');
        }

        loadSchools();
    </script>
</body>
</html>
